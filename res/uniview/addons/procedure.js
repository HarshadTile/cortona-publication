/*! Cortona3D Solo Universal Viewer bundle - procedure, Copyright (c) 2015-2025 Paragraphics Ltd. (http://www.cortona3d.com/) */
define((function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}({12:function(e,t,r){var n;void 0===(n=function(e,t,n){var o,a,i=Cortona3DSolo,c=i.app.procedure,p=c.interactivity,u=p&&!!p.json.$text("SimulationInteractivity/SimulationInformation/DocumentFile"),d=!1,f=null,l=null,s=c.RANGE_VALUE_CURRENT_STEP,g=0,b=i.app.util.Vec3f;if(c&&"function"!=typeof c.drawAttention){var h=c.backward,m=c.forward,O=c.seekToSubstep;c.defaultSeekMode=c.SEEK_TO_CUE_POINT,p&&i.on("app.procedure.didEnterSubstepWithName",(function(e){a=e;var t=(s=w(e))===p.getProcedureId(),r=!1,n=!1,o=f;if(o&&!t){var c=o.indexOf(s);r=c<o.length-1,n=c>0}i.dispatch("app.procedure.didEnableForward",r),i.dispatch("app.procedure.didEnableBackward",n)})),i.on("app.procedure.didChangePlayerState",(function(e,t){var r=void 0===o?16777215:t^o;o=t,g=e,1&r&&(I()?(i.dispatch("app.procedure.didPlay"),i.app.procedure.requestPlayerState()):i.dispatch("app.procedure.didStop")),1024&r&&i.dispatch("app.procedure.didPlaySound",!!(1024&t)),256&r&&i.dispatch("app.procedure.didEnableForward",!!(256&t)),512&r&&i.dispatch("app.procedure.didEnableBackward",!!(512&t)),0===e?(i.dispatch("app.procedure.onStartPosition"),1&r&&I()&&i.dispatch("app.procedure.didStart")):e>=i.app.procedure.duration&&(i.dispatch("app.procedure.onEndPosition"),1&r&&(I()||i.dispatch("app.procedure.didFinish")))})),Object.defineProperty(i.app.procedure,"locked",{get:function(){return d},set:function(e){(d=e)?y():c.setPlayRange&&c.setPlayRange(null,null,c.RANGE_FLAGS_DO_NOT_RECALCULATE_POSITION)},enumerable:!0,configurable:!0}),Object.defineProperty(i.app.procedure,"played",{get:I,enumerable:!0,configurable:!0}),Object.defineProperty(i.app.procedure,"position",{get:function(){return g},enumerable:!0,configurable:!0}),Object.defineProperty(i.app.procedure,"context",{get:function(){return[].concat(f||[])},enumerable:!0,configurable:!0}),Object.defineProperty(i.app.procedure,"state",{get:function(){return o},enumerable:!0,configurable:!0});var v={};i.expand(i.app.procedure,{toggleDrawingDisplayMode:function(e){i.dispatch("app.procedure.didDrawingDisplayMode",e),i.app.drawing.show(e),i.app.ui.showCanvas(!e)},getContextItemId:w,getActiveItemId:function(e){var t=e,r=p.getProcedureItemInfo(t),n=p.getProcedureItemInfo(_(t));if(r&&"action"===r.type&&!x(t))if(n.children&&n.children.length||n.actions.some(x)){var o=N(n.raw["@children"]||[]),a=0,i=o.indexOf(t);if(o.some(x)){do{t=o[i+(a=0===a?-1:a<0?-a:-a-1)]}while(!x(t));if("step"===(r=p.getProcedureItemInfo(t)).type){var c=function e(t){var r=[],n=p.getProcedureItemInfo(t);switch(n.type){case"action":n.comment&&(r=[t]);break;case"step":r=n.children&&n.children.length||n.actions.some(x)?N(n.raw["@children"]||[]).filter(x).reduce((function(t,r){return t.concat(e(r))}),[]):[t]}return r}(t);c.length&&(t=a>0?c[0]:c[c.length-1])}}else t=n.id}else t=n.id;return t},isValidContextItem:x,hoverObject:function(e,t,r){var n=[e],o=i.app.getHoveredObjects();n.forEach((function(e){var r=o.indexOf(e);t?r<0&&o.push(e):r>=0&&o.splice(r,1)})),i.app.setHoveredObjects(o,r)},hoverItem:function(e,t){e&&p.getObjectNamesByDocId(e).map(i.app.getObjectWithName).forEach((function(e){i.app.procedure.hoverObject(e,t,!0)}))},selectItem:function(e,t,r){if(e){var n=p.getObjectNamesByDocId(e).map(i.app.getObjectWithName),o=i.app.getSelectedObjects();n.forEach((function(e){var r=o.indexOf(e);t?r<0&&o.push(e):r>=0&&o.splice(r,1)})),i.app.setSelectedObjects(o,r)}},isItemVisible:function(e){return p.getObjectNamesByDocId(e).map(i.app.getObjectWithName).some((function(e){return 0===i.app.getObjectVisibility(e)}))},drawAttention:function(e,t){if(!(i.app.selectionMode>0)){var r=Array.isArray(e)?e:[e];return new Promise((function(e,n){var o,a=!1;function c(e){a=arguments.length?e:!a,r.forEach((function(e){e&&i.app.procedure.hoverObject(e,a,!0)}))}function p(){clearInterval(o),delete v[o],c(!1),e()}t=t||3,i.app.fitObjectsInView(r,!0,.5),o=setInterval(c,250),v[o]={finish:p,timeout:setTimeout(p,1e3*t)}}))}},drawAttentionEx:function(e,t,r){r=r||"Shape {                 geometry Sphere {}                 appearance Appearance {                     material Material {                         diffuseColor .8 .31 0                         specularColor .5 .5 .5                         emissiveColor .1 .1 .1                         ambientIntensity 0                         transparency .5                     }                 }             }";var n=Array.isArray(e)?e:[e],o=new Array(n.length);return new Promise((function(e,a){var c,p=!1,u=new Date;function d(e){p=arguments.length?e:!p,n.forEach((function(e){e&&i.app.procedure.hoverObject(e,p,!0)}))}t=t||3,i.app.fitObjectsInView(n,!0,.5),n.forEach((function(e,t){if(e){var n=i.app.getObjectBoundingBox(e);if(n){var a=new b(n.size).length()/1.8,c=i.app.createObjectsFromString("Transform { children Transform { scale "+a+" "+a+" "+a+" children "+r+" } }");c&&(i.app.addObjects(c,e),o[t]=c[0])}}})),c=setInterval(d,250);var f=setInterval((function(){var e=(new Date-u)%1e3,t=.35*(Math.cos((e-500)/500*Math.PI)+1)+.3;o.forEach((function(e){i.app.setObjectPropertyf(e,i.app.PROPERTY_SCALE,!1,t,t,t)}))}),10);function l(){clearInterval(c),clearInterval(f),delete v[c],d(!1),n.map((function(e,t){e&&i.app.removeObjects(o[t],e)})),e()}v[c]={finish:l,timeout:setTimeout(l,1e3*t)}}))},clearAllAttentions:function(){for(var e in v)clearInterval(e),clearTimeout(v[e].timeout),v[e].finish()}}),i.expand(i.app.procedure,{forward:function(e){d&&(c.stop(),c.setPlayRange());var t=f;if(t){for(var r=t.indexOf(s)+1;r<t.length&&!x(t[r]);)r++;r<t.length&&O(t[r],e)}else m(e);d&&y()},backward:function(e){d&&(c.stop(),c.setPlayRange());var t=f;if(t){for(var r=t.indexOf(s)-1;r>=0&&!x(t[r]);)r--;r>=0&&O(t[r],e)}else h(e);d&&y()},seekToSubstep:S}),p&&(i.expand(p,{getObjects:function(e){var t=[],r=Array.isArray(e)?e:[e];return(r=r.reduce((function(e,t){return e.concat(p.getDocItemInfo(t)?p.getObjectNamesByDocId(t):t)}),[])).forEach((function(e){t.indexOf(e)<0&&t.push(e)})),t.map(i.app.getObjectWithName).filter((function(e){return!!e}))},getDocIdForObject:function(e){for(var t=p.getDocIdByObjectName(i.app.getObjectName(e));!t&&e;)e=i.app.getParentObject(e),t=p.getDocIdByObjectName(i.app.getObjectName(e));return t},getScreenTip:function(e){return(p.getDocItemInfo(p.getDocIdByObjectName(e))||{}).screentip||""}}),i.on("touch.didObjectEnter",(function(e,t){var r=p.getDocIdForObject(e);r&&i.dispatch("procedure.didObjectEnter",r)})),i.on("touch.didObjectOut",(function(e,t){var r=p.getDocIdForObject(e);r&&i.dispatch("procedure.didObjectOut",r)})),i.on("touch.didObjectClick",(function(e,t,r,n,o,a,c){var u=p.getDocIdForObject(e);u&&i.dispatch("procedure.didObjectClick",u,r,n,o,a,c)})),i.on("procedure.selectObjects",(function(e){var t=p.getObjects(e);i.uniview.options.UseLegacy3DPartDrawAttention?(i.app.procedure.clearAllAttentions(),i.app.procedure.drawAttention(t)):(i.app.setSelectedObjects(t,!0),i.app.fitObjectsInView(t,!0,.5))})),S(p.getProcedureId()),r(13)),i.on("app.procedure.didChangePlayableItemList",(function(e,t){l=t}))}function I(){return!!(1&(o||0))}function y(){c.setPlayRange("object"==typeof d?d.start:s,"object"==typeof d?d.end:null,c.RANGE_FLAGS_REQUEST_NOTIFICATION|c.RANGE_FLAGS_DO_NOT_RECALCULATE_POSITION);var e=c.getPlayableRangeStartTime(),t=c.getPlayableRangeStopTime();i.dispatch("app.procedure.didChangePlayableRange",e,t)}function j(e){return!!e&&("step"===e.type&&(!e.actions.length&&e.children.map(p.getProcedureItemInfo).every(j)))}function P(e){if(p){var t,r=p.getProcedureId(),n=p.getProcedureItemInfo(e)||p.getProcedureItemInfo(r);if(n){switch(f=[],n.type){case"procedure":f=n.raw.$("Item");break;case"step":case"action":t=p.getProcedureItemInfo(n.parent),f=u?t.raw.$("Item"):t.raw["@children"]}f=N(f||[]),l&&(f=f.filter((function(e){for(var t=e;t;t=p.getProcedureItemInfo(t).parent)if(l.indexOf(e)>=0)return!0;return!1}))),f.length||(f=null)}}}function S(e,t){j(p&&p.getProcedureItemInfo(e))||(d&&(c.stop(),c.setPlayRange()),P(e),O&&(O(e,t),setTimeout((function(){i.app.procedure.requestPlayerState(),d&&y()}),0)))}function E(e){for(var t=0,r=e;r;)r=_(r),t++;return t}function w(e){var t,r,n,o=e||a,i=c.RANGE_VALUE_CURRENT_STEP;if(p)if(t=p.getProcedureItemInfo(o)||{},i=o=u&&"action"===t.type?t.parent||t.parentStep:o,f){for(n=E(f[0]);i&&f.indexOf(i)<0;)i=_(i);if(!i){for(r=f.join(""),i=o;E(i)>n;)i=_(i);P(i),f&&r!==f.join("")?(A().length||P(_(i)),i=w(o)):i=t.parentStep||p.getProcedureId()}i=function(e){var t,r=e,n=0;if(context=A(),r&&f&&context.length&&(t=f.indexOf(r))>=0)for(;context.indexOf(r)<0;)r=f[t+(n=0===n?-1:n<0?-n:-n-1)];return r}(i)}else i=t.parentStep||p.getProcedureId();return i}function A(){return f&&f.filter(x)}function x(e){var t=p.getProcedureItemInfo(e);return t&&("action"!==t.type||t.comment&&!i.uniview.options.HideActions&&!u)}function _(e){return(p.getProcedureItemInfo(e)||{}).parent}function N(e){return e.reduce((function(e,t){var r=t.$attr("id"),n=r&&p.getProcedureItemInfo(r);return n&&!j(n)?e.concat(r):e}),[])}}.call(t,r,t,e))||(e.exports=n)},13:function(e,t,r){var n;void 0===(n=function(e,t,r){var n=Cortona3DSolo,o=n.uniview.ixml,a={};n.__trace=!0,n.app.observeObjectVisibility?(o.getDocItems().map(o.getObjectNamesByDocId).flat().map(n.app.getObjectWithName).forEach(e=>{n.app.observeObjectVisibility(e),a[e]=0===n.app.getObjectVisibility(e)}),n.on("app.didChangeVisibility",(function(e,t){e.forEach(e=>a[e]=!0),t.forEach(e=>a[e]=!1),n.dispatch("app.procedure.didChangeVisibility",a)})),n.once("uniview.ready",(function(){n.dispatch("app.procedure.didChangeVisibility",a)})),n.once("uniview.doc.didLoadComplete",(function(){n.dispatch("app.procedure.didChangeVisibility",a)}))):console.log("To track the visibility of an object, Solo 2.6.1+ is required.")}.call(t,r,t,e))||(e.exports=n)}})}));